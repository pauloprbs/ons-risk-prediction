-- ====================================================================
-- SCRIPT 03: CARGA DOS ARQUIVOS DO STAGE PARA AS TABELAS RAW
-- Propósito: Popular as tabelas brutas com os dados de todos os arquivos do stage.
-- Execução: Execute este script após criar as tabelas com o script 02.
-- ====================================================================

USE WAREHOUSE DBT_WH;
USE DATABASE RAW_DB;
USE SCHEMA ONS_DATA;

-- NOTA: A opção PURGE = FALSE foi adicionada para garantir que os arquivos
-- não sejam deletados do stage após a carga, permitindo re-execuções para desenvolvimento.

-- Dados que você gerou localmente (snapshot das APIs/arquivos dinâmicos)
COPY INTO INTERRUPCAO_CARGA_RAW FROM @ONS_RAW_STAGE/interrupcao/ FILE_FORMAT = (FORMAT_NAME = 'ONS_CSV_FORMAT') PURGE = FALSE ON_ERROR = 'CONTINUE';
COPY INTO CARGA_VERIFICADA_RAW FROM @ONS_RAW_STAGE/carga_verificada/ FILE_FORMAT = (FORMAT_NAME = 'ONS_PARQUET_FORMAT') MATCH_BY_COLUMN_NAME = 'CASE_INSENSITIVE' PURGE = FALSE ON_ERROR = 'CONTINUE';
COPY INTO CARGA_PROGRAMADA_RAW FROM @ONS_RAW_STAGE/carga_programada/ FILE_FORMAT = (FORMAT_NAME = 'ONS_PARQUET_FORMAT') MATCH_BY_COLUMN_NAME = 'CASE_INSENSITIVE' PURGE = FALSE ON_ERROR = 'CONTINUE';
COPY INTO CLIMA_GO_DIARIO_RAW FROM @ONS_RAW_STAGE/clima/ FILE_FORMAT = (TYPE = 'CSV' FIELD_DELIMITER = ',' SKIP_HEADER = 1) PURGE = FALSE ON_ERROR = 'CONTINUE';

-- Dados históricos (particionados por data)
COPY INTO GERACAO_USINA_RAW FROM @ONS_RAW_STAGE/geracao_usina/ FILE_FORMAT = (FORMAT_NAME = 'ONS_CSV_FORMAT') PURGE = FALSE ON_ERROR = 'CONTINUE';
COPY INTO RESTRICAO_EOLICA_RAW FROM @ONS_RAW_STAGE/restricao_eolica/ FILE_FORMAT = (FORMAT_NAME = 'ONS_CSV_FORMAT') PURGE = FALSE ON_ERROR = 'CONTINUE';
COPY INTO RESTRICAO_FOTOVOLTAICA_RAW FROM @ONS_RAW_STAGE/restricao_fotovoltaica/ FILE_FORMAT = (FORMAT_NAME = 'ONS_CSV_FORMAT') PURGE = FALSE ON_ERROR = 'CONTINUE';
COPY INTO INTERCAMBIO_NACIONAL_RAW FROM @ONS_RAW_STAGE/intercambio_nacional/ FILE_FORMAT = (FORMAT_NAME = 'ONS_CSV_FORMAT') PURGE = FALSE ON_ERROR = 'CONTINUE';
COPY INTO EAR_DIARIO_RAW FROM @ONS_RAW_STAGE/ear_diario/ FILE_FORMAT = (FORMAT_NAME = 'ONS_CSV_FORMAT') PURGE = FALSE ON_ERROR = 'CONTINUE';
COPY INTO ENA_DIARIO_RAW FROM @ONS_RAW_STAGE/ena_diario/ FILE_FORMAT = (FORMAT_NAME = 'ONS_CSV_FORMAT') PURGE = FALSE ON_ERROR = 'CONTINUE';
COPY INTO CMO_SEMANAL_RAW FROM @ONS_RAW_STAGE/cmo_semanal/ FILE_FORMAT = (FORMAT_NAME = 'ONS_CSV_FORMAT') PURGE = FALSE ON_ERROR = 'CONTINUE';
COPY INTO DISPONIBILIDADE_USINA_RAW FROM @ONS_RAW_STAGE/disponibilidade_usina/ FILE_FORMAT = (FORMAT_NAME = 'ONS_CSV_FORMAT') PURGE = FALSE ON_ERROR = 'CONTINUE';

-- ====================================================================
-- SCRIPT DE VERIFICAÇÃO (OPCIONAL)
-- Execute este select para ver a contagem de linhas de cada tabela carregada.
-- ====================================================================

SELECT 'INTERRUPCAO_CARGA_RAW' AS table_name, COUNT(*) AS row_count FROM INTERRUPCAO_CARGA_RAW UNION ALL
SELECT 'CARGA_VERIFICADA_RAW' AS table_name, COUNT(*) AS row_count FROM CARGA_VERIFICADA_RAW UNION ALL
SELECT 'CARGA_PROGRAMADA_RAW' AS table_name, COUNT(*) AS row_count FROM CARGA_PROGRAMADA_RAW UNION ALL
SELECT 'GERACAO_USINA_RAW' AS table_name, COUNT(*) AS row_count FROM GERACAO_USINA_RAW UNION ALL
SELECT 'RESTRICAO_EOLICA_RAW' AS table_name, COUNT(*) AS row_count FROM RESTRICAO_EOLICA_RAW UNION ALL
SELECT 'RESTRICAO_FOTOVOLTAICA_RAW' AS table_name, COUNT(*) AS row_count FROM RESTRICAO_FOTOVOLTAICA_RAW UNION ALL
SELECT 'INTERCAMBIO_NACIONAL_RAW' AS table_name, COUNT(*) AS row_count FROM INTERCAMBIO_NACIONAL_RAW UNION ALL
SELECT 'EAR_DIARIO_RAW' AS table_name, COUNT(*) AS row_count FROM EAR_DIARIO_RAW UNION ALL
SELECT 'ENA_DIARIO_RAW' AS table_name, COUNT(*) AS row_count FROM ENA_DIARIO_RAW UNION ALL
SELECT 'CMO_SEMANAL_RAW' AS table_name, COUNT(*) AS row_count FROM CMO_SEMANAL_RAW UNION ALL
SELECT 'DISPONIBILIDADE_USINA_RAW' AS table_name, COUNT(*) AS row_count FROM DISPONIBILIDADE_USINA_RAW UNION ALL
SELECT 'CLIMA_GO_DIARIO_RAW' AS table_name, COUNT(*) AS row_count FROM CLIMA_GO_DIARIO_RAW;